# Dev Container Setup Guide

A step-by-step guide to set up a development environment using VS Code Dev Containers for the Realistic Spell FPS project.

# Table of Contents
- [Get VS Code](#get-vs-code)
- [Install Dev Containers Extension](#install-dev-containers-extension)
- [Install Docker](#install-docker)
- [Configure SSH Agent](#configure-ssh-agent)
- [Clone Repository](#clone-repository)
- [Build Dev Containers](#build-dev-containers)
- [Open in Dev Container](#open-in-dev-container)
- [Optional: Configure GPG for Commit Signing](#optional-configure-gpg-for-commit-signing)

---

# Get VS Code

Download and install Visual Studio Code from [https://code.visualstudio.com/](https://code.visualstudio.com/).

### Windows
1. Run the installer.
2. Select **Add to PATH** option.

### Linux
**Ubuntu/Debian:**
```bash
sudo snap install --classic code
```
_or_ download the .deb package and install with dpkg.

**Fedora:**
```bash
sudo dnf install code
```

**Arch Linux:**
```bash
sudo pacman -S code
```

# Install Dev Containers Extension

1. Open VS Code.
2. Press `Ctrl+Shift+X` to open Extensions.
3. Search for **Dev Containers**.
4. Click **Install**.

# Install Docker

Docker provides the container runtime for Dev Containers.

### Windows
1. Download Docker Desktop from [https://www.docker.com/products/docker-desktop/](https://www.docker.com/products/docker-desktop/).
2. Follow instructions at [Docker WSL 2 Backend](https://docs.docker.com/desktop/features/wsl/) to set up WSL 2 if not already done.
3. Run the installer.
4. Follow the installation prompts and restart if necessary. 
5. Open Docker Desktop to ensure it's running.

### Linux

Use the official [Docker installation instructions](https://docs.docker.com/engine/install/ubuntu/) to figure out the best way to install Docker on your specific Linux distribution.

> **⚠️ Warning** </br>
> This section was generated by ChatGPT and GitHub Copilot and is not verified. Proceed with caution!

**Ubuntu/Debian:**
```bash
sudo apt-get update
sudo apt-get install ca-certificates curl
sudo install -m 0755 -d /etc/apt/keyrings
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg
sudo chmod a+r /etc/apt/keyrings/docker.gpg
echo "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu $(. /etc/os-release && echo "$VERSION_CODENAME") stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
sudo apt-get update
sudo apt-get install docker-ce docker-ce-cli containerd.io docker-buildx-plugin
```

**Fedora:**
```bash
sudo dnf -y install dnf-plugins-core
sudo dnf config-manager --add-repo https://download.docker.com/linux/fedora/docker-ce.repo
sudo dnf install docker-ce docker-ce-cli containerd.io docker-buildx-plugin
```

**Arch Linux:**
```bash
sudo pacman -S docker
```

#### Configure Docker for Non-Root Access
```bash
sudo groupadd docker
sudo usermod -aG docker $USER
newgrp docker  # or log out/in
docker run hello-world
```

#### Enable Docker Service
```bash
sudo systemctl enable docker.service
sudo systemctl enable containerd.service
sudo systemctl start docker.service
```

# Configure SSH Agent

Ensure your SSH keys are available for authentication inside the container. To do this, make sure ssh-agent is running and your keys are added. The ssh-agent is automatically forwarded into the dev container from host.

You may need to restart your terminal, VS Code, or system after setting this up.

### Linux
```bash
eval "$(ssh-agent -s)"
ssh-add ~/.ssh/id_rsa  # or your key file
ssh-add -l
```

### Windows
```powershell
# Enable ssh-agent service
Get-Service ssh-agent | Set-Service -StartupType Automatic -PassThru | Start-Service

# Add your key
ssh-add $env:USERPROFILE\.ssh\id_rsa
ssh-add -l
```

# Clone Repository

```bash
git clone https://github.com/AdamBajger/realistic-spell-fps.git
cd realistic-spell-fps
```

# Build Dev Containers

Use the provided scripts to build or pull the dev container images, if they're not already available locally. 

### Linux
```bash
./scripts/dev-setup/build-devcontainer.sh
```

### Windows
```powershell
.\scripts\dev-setupuild-devcontainer.ps1
```

# Open in Dev Container

1. Open VS Code.
2. Open the cloned repository folder.
3. When prompted "Folder contains a Dev Container configuration file. Reopen folder to develop in a container", click **Reopen in Container**.
4. If not prompted: Press `F1`, type **Dev Containers: Reopen in Container**, press Enter.

> First-time setup may take several minutes; subsequent opens are faster.

# Optional: Configure GPG for Commit Signing

### Install GPG

**Linux:**
```bash
sudo apt-get install gnupg   # Ubuntu/Debian
sudo dnf install gnupg2       # Fedora
sudo pacman -S gnupg          # Arch Linux
```

**Windows:**
Download and install [Gpg4win](https://www.gpg4win.org/).

### Generate GPG Key

```bash
gpg --full-generate-key
```
_Follow prompts: RSA/RSA, 4096-bit, expiration 0, your name/email_

### Configure Git signing using
Use the provided scripts to configure GPG signing for Git.
- Linux: `scripts/dev-setup/setup-gpg-signing-for-git.sh`
- Windows: `scripts/dev-setup/setup-gpg-signing-for-git.ps1`

Example use:
```bash
sh scripts/dev-setup/setup-gpg-signing-for-git.sh --keyid=AH88911D222F4A5718D53938525D694205318008 --email user@email.com
```
The scripts contain more options; run with `--help` for details.

To configure manually, read the scripts to see what they do, then run equivalent commands.

### Add Public Key to GitHub
Add your GPG public key to [GitHub](https://github.com/settings/keys).

# Summary

You are now ready to develop in a consistent, containerized environment. The dev container includes:
- Rust toolchain
- Build dependencies
- Development tools (rustfmt, clippy, rust-analyzer)
- Project-specific configurations

All builds, tests, and development happen inside the container, ensuring consistency across developer machines and CI/CD pipelines.
